<!DOCTYPE html>
<html
    layout:decorate="~{layouts/layout}"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<body>
<div layout:fragment="content">
    <div class="contWrap projectWrap projWriteWrap">
        <div class="subTitleWrap">
            <p class="title">프로젝트 등록</p>
        </div>
        <div class="writeWrap">
            <form action="/write" method="post" enctype="multipart/form-data">
                <ul class="listBox">
                    <li class="list01 list">
                        <p class="tit">프로젝트명</p>
                        <div class="txtBox">
                            <select name="projectStatus" id="recommendProj">
                                <option value="NOTICE">추천</option>
                                <option value="GENERAL">일반</option>
                            </select>
                            <input type="text" name="title" placeholder="프로젝트명">
                        </div>
                    </li>
                    <li class="list">
                        <p class="tit">카테고리 설정</p>
                        <div class="txtBox">
                            <ul class="check">
                                <li th:each="category : ${T(com.portfolio.constant.ProjectCategoryStatus).values()}">
                                    <input type="checkbox" 
                                           th:id="${'category-' + category.name()}"
                                           th:value="${category.name()}"
                                           name="categories">
                                    <label th:for="${'category-' + category.name()}" 
                                           th:text="${category.displayName}">카테고리명</label>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="list">
                        <p class="tit">클라이언트</p>
                        <div class="txtBox">
                            <input type="text" name="client">
                        </div>
                    </li>
                    <li class="list">
                        <p class="tit">타입</p>
                        <div class="txtBox">
                            <input type="text" name="type">
                        </div>
                    </li>
                    <li class="list">
                        <p class="tit">작업 툴</p>
                        <div class="txtBox">
                            <input type="text" name="tool">
                        </div>
                    </li>
                    <li class="list list02">
                        <p class="tit">프로젝트 컨셉</p>
                        <div class="txtBox">
                            <textarea name="concept"  th:utext="${htmlConcept}"></textarea>
                            <p class="ex">&lt;span class="bold"&gt;는 글씨 크기가 굵게, &lt;span class="color"&gt;는 포인트 컬러로 색상 변경됩니다.</p>
                        </div>
                    </li>
                    <li class="list list02 list03">
                        <p class="tit">프로젝트 참여도</p>
                        <div class="txtBox">
                            <textarea name="part" th:utext="${htmlPart}"></textarea>
                            <p class="ex">&lt;span class="bold"&gt;는 글씨 크기가 굵게, &lt;span class="color"&gt;는 포인트 컬러로 색상 변경됩니다.</p>
                        </div>
                    </li>
                    <li class="list list02">
                        <p class="tit">프로젝트 설명</p>
                        <div class="txtBox">
                            <textarea name="detail" th:utext="${htmlDetail}"></textarea>
                            <p class="ex">&lt;span class="bold"&gt;는 글씨 크기가 굵게, &lt;span class="color"&gt;는 포인트 컬러로 색상 변경됩니다.</p>
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">메인 배너</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="bannerImg">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">미리보기 이미지</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="previewImg">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">메인 페이지</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="mainImg">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">서브 페이지 01</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="subImg01">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">서브 페이지 02</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="subImg02">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">상세 페이지 01</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="detailImg01">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">상세 페이지 02</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="detailImg02">
                        </div>
                    </li>
                    <li class="list listImg">
                        <p class="tit">ETC</p>
                        <div class="txtBox">
                            <input type="file" name="projectImgFile" id="etcImg">
                        </div>
                    </li>
                    <li class="list">
                        <p class="tit">사이트 주소</p>
                        <div class="txtBox">
                            <input type="text" name="url">
                        </div>
                    </li>
                </ul>

                <div class="btnWrap">
                    <button type="submit">등록</button>
                </div>
            </form>
        </div>

    </div>
</div>

<script th:inline="javascript">
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 폼 데이터 수집
        const formData = new FormData(this);
        
        // 체크된 카테고리들 처리
        const checkedCategories = document.querySelectorAll('input[name="categories"]:checked');
        formData.delete('categories'); // 기존 카테고리 데이터 삭제
        checkedCategories.forEach(checkbox => {
            formData.append('categories', checkbox.value);
        });
        
        // 폼 제출
        fetch('/write', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                window.location.href = '/project';
            } else {
                alert('프로젝트 등록에 실패했습니다.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('프로젝트 등록 중 오류가 발생했습니다.');
        });
    });
});
</script>
</body>
</html>